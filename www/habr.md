# TODO TITLE
---

## Введение
Наконец дошли руки поиграться с чудной программой для визуализации графов Gephi и желательно на реальных данных, скрапить то мне тоже нравится. 
По музыке граф уже есть (https://habr.com/company/semrush/blog/337216/), по фильмам тоже (https://habr.com/company/ods/blog/348110/), очередной граф соцсетей делать совсем не улыбалось, а что там у нас ещё в интернетах то есть? 
Вот тут то меня осенило! В общем встречайте граф связей роликов с pornhub.com =) 
<todo КДПВ> 

<cut>
Почему pornhub? Да потому что я всегда считал его самым крупным игроком рынка. 
На деле же оказалось, что это их маркетологи лучше других работают на наш рынок, а сам сайт только на третьем месте в мире (https://www.similarweb.com/top-websites/category/adult), но коней на скаку менять было поздно.

Вообще я всегда считал, что контент для взрослых занимает львиную долю интернета, а уж трафика так вообще лидирующую. 
Было нелегко смириться с ошибочностью данного утверждения. 
Исследований не так много, но даже в самых смелых оценках на долю адалта приходится всего 14% кликов и 4% сайтов. 
Конечно 14% кликов это не шутки, но я всегда ожидал большего. 


## Что будем делать
На самом хабе с каждого ролика есть ссылки на рекомендованные, притом эти рекомендации более или менее закреплены за роликом и слабо зависят от истории просмотров.
Вот эти рекомендации мы и возьмём в качестве рёбер нашего графа.  
В первом варианте предполагалось начинать со случайного ролика, обходить пауком по связямь вглубь на два-три уровня, строить граф по тому что собрали за один проход и сравнивать полученные результаты.
Но оказалось, что глубины в три уровня маловато, а скрапить больше порнхаб всячески мешает.
В итоге же решено было идти от ТОП10 самых просматриваемых роликов так глубоко, насколько хватит терпения и производительности браузера (об этом далее).    
Должен получиться этакий милый граф друзей, призванный распределять приходящий на сайт трафик.
 

## Сбор данных
Курлом парсится на ура, но после 40 запросов пытается мешать - выдаёт хтмл с кодом на яваскрипте, который некоторое время думает и только потом открывает тебе страничку, причём время ожидания увеличивается всё больше.
Версия на пупитере, работает стабильно, ждёт тайтл на странице (обходит блокировку), но долго.
Открываем сразу несколько окон в пупитере, так выходит быстрее, но нарываемся на блокировку уже с 429 кодом (видимо считают количество запросов с ипишки).
Адекватный рейт только при 2 воркерах с одной ипишки, но больше времени на эксперименты не осталось, спарсил и так в фоновом режиме, пока основной проект делал.
API порнхаба вроде рассчитано на встраивание в сайты, но не проходит по корсам =( Пришлось парсить и загонять в атрибуты, и там тоже ограничение на количество запросов совсем небольшое (как так то??)


## Визуализация
Давно руки чесались воспользоваться gephi, который отказывался рендерить картинки на моей машине. 
Оказалось всё дело в видеокарте ноута и ```libEGL warning: failed to create a pipe screen for i965```.
Посколько данных у нас более чем немного, решено было воспользоваться плагином к sigmajs и выложить результат в интерактивном виде.
Алгоритм gephi - может кто посоветует плагин или доку на cli интерфейс, что бы можно было описать сценарий работы с данными, а не повторять каждый раз ручками?
Проблема с кириллицей - банальные кодировки, но времени решать упорно не нашлось, так что 6 роликов пришлось просто вырезать. 
Простите меня, борцы за консистентность, в своё оправдание скажу, что в .dot файле данные все.
Описание легенды


## Что получилось
гифка по уровням друзей в 5 уровней
линк на сайт
Отмечу наличие галочки, которая по умолчанию не показывает превью ролика. 
Тем не менее названия скрыть не в моих силах, потому людям которые не хотят прочитать кликбейтные тексты на порно тематику ходить строго не рекомендую =)
интересно что ТОП10 по прошествии пары недель стал аналогичен моему топу по входящей степени - видимо обсчитывают несколько отложенно.


## Что ещё можно сделать с этими данными
Некоторые статистики я намеренно не стал включать в статью банально опасаясь потревожить скрепы сообщества, описать тем не менее могу:
* посмотреть как пересекаются теги по роликам
* кластеризовать и выделить главные жанры (смею утверждать - самые популярные видны и без явного разделения на кластеры на текущей визуализации)
* построить отдельный граф коллег среди актёров (эта идея пришла уже в завершающей стадии проекта и не получила продолжения, тем не менее было бы интересно посмотреть кто с кем чаще всего снимается, данные то открыты у большинства роликов)  
* посчитать множество статистик у самых весомых роликов и найти общее (например прододжительность)


## Уголок права
Понимая что тема скользская я проконсультировался в паре юр контор на тему применимости 242УК к такого рода проекту. 
Результатом стал банер с предупреждением о контенте 18+ с обязательным апрувом от пользователя. 
По словам юристов такого рода заглушка выводит нас из под пункта о прямом умысле и тем самым делает 242 статью неприменимой, но как бы то ни было буду рад мнению сообщества по этому вопросу, поскольку сам полнейший профан в данном вопросе. 
Что касается авторских прав на контент, то согласно соглашению о партнёрстве на hubtraffic (https://www.hubtraffic.com/terms) у нас всё чисто - видео я не предоставляю и не выкачиваю, рекламы и спам не вставляю.



## Послесловие
пробный шар
линк на сорцы
линк на сайт
просьба фидбека по идеям, что ещу можно схожим данным сделать






