# TODO TITLE
---

## Введение
Наконец дошли руки поиграться с чудной программой для визуализации графов Gephi и желательно на реальных данных, скрапить то мне тоже нравится. 
По музыке граф уже есть (https://habr.com/company/semrush/blog/337216/), по фильмам тоже (https://habr.com/company/ods/blog/348110/), очередной граф соцсетей делать совсем не улыбалось, а что там у нас ещё в интернетах то есть? 
Вот тут то меня осенило! В общем встречайте граф связей роликов pornhub.com =) 
<todo КДПВ> 

<cut>
Почему pornhub? Да потому что я всегда считал его самым крупным игроком рынка. 
На деле оказалось, что это победа их маркетологов на нашем рынке, а по фактической посещаемости сайт только на третьем месте в мире (https://www.similarweb.com/top-websites/category/adult), но коней на скаку менять было поздно.

Вообще я всегда считал, что контент для взрослых занимает львиную долю интернета, а уж трафика так вообще лидирующую. 
Было нелегко смириться с ошибочностью данного утверждения. 
Исследований не так много, но даже в самых смелых оценках на долю адалта приходится всего 14% кликов и 4% сайтов, что впрочем тоже немало. 


## Что будем делать
На самом хабе с каждого ролика есть ссылки на рекомендованные, притом эти рекомендации более или менее закреплены за роликом и слабо зависят от истории просмотров конекретного посетителя.
Вот эти рекомендации мы и возьмём в качестве рёбер нашего графа. 
Вершинами же будут сами ролики.  
Начинать составлять граф будем с ТОП10 самых просматриваемых роликов.    
Должен получиться этакий милый граф друзей, призванный распределять приходящий на сайт трафик - будем считать что ТОП10 не просто так существует, а именно с целью раскидать входящих хитов.


## Сбор данных
Для начала всегда пробую в лоб спарсить курлом и смотрю на результаты.
Сперва всё шло хорошо, но уже после сорока запросов хаб пытается мешать и выдаёт страничку с js-кодом, который некоторое время думает перед тем, как отдать контент страницы, причём время ожидания увеличивается прямо пропорционально частоте запросов.
С проксями возиться не хотелось, потому сразу накидал парсер на puppeteer. 
Такой парсер работает стабильно, ждёт заголовок страницы (обходит блок с помощью яваскрипта), но долго.
Если же открыть сразу много окон то очень быстро хаб начинает блочить уже 429 кодом.
Адекватный рейт только при двух окнах/воркерах с одного ip.
На этом варианте и решено было остановиться, поскольку с нашим объёмом тратить время на разгон этого процесса не имело смысла.


## Визуализация
Давно руки чесались воспользоваться Gephi, который отказывался рендерить картинки на моей машине. 
Оказалось всё дело в видеокарте ноута и известной проблеме ```libEGL warning: failed to create a pipe screen for i965```.

>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
 
В нашем случае 

Посколько данных у нас более чем немного, решено было воспользоваться плагином к sigmajs и выложить результат в интерактивном виде.
Алгоритм gephi - может кто посоветует плагин или доку на cli интерфейс, что бы можно было описать сценарий работы с данными, а не повторять каждый раз ручками?
Проблема с кириллицей - банальные кодировки, но времени решать упорно не нашлось, так что 6 роликов пришлось просто вырезать. 
Простите меня, борцы за консистентность, в своё оправдание скажу, что в .dot файле данные все.
Описание легенды
Плагин к сигме,жс


## Что получилось
гифка по уровням друзей в 5 уровней
линк на сайт
Отмечу наличие галочки, которая по умолчанию не показывает превью ролика. 
Тем не менее названия скрыть не в моих силах, потому людям которые не хотят прочитать кликбейтные тексты на взрослую тематику ходить строго не рекомендую =)
интересно что ТОП10 по прошествии пары недель стал аналогичен моему топу по входящей степени - видимо обсчитывают несколько отложенно.



## Что ещё можно сделать с этими данными
Некоторые статистики я намеренно не стал включать в статью банально опасаясь потревожить скрепы сообщества, описать тем не менее могу:
* посмотреть как пересекаются теги по роликам
* кластеризовать и выделить популярные жанры (смею утверждать - самые популярные видны и без явного разделения на кластеры на текущей визуализации)
* построить отдельный граф коллег среди актёров - идея пришла уже в завершающей стадии проекта и не получила продолжения, тем не менее было бы интересно посмотреть кто с кем чаще всего снимается, данные то открыты у большинства роликов;  
* посчитать множество статистик у самых весомых роликов и найти общее (например прододжительность)


## Послесловие
пробный шар
линк на сорцы
линк на сайт
просьба фидбека по идеям, что ещу можно схожим данным сделать






